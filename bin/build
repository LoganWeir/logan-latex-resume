#!/usr/bin/env bash

# Check if exactly one argument is provided
if [ "$#" -ne 1 ]; then
    echo "Usage: $0 {g|be|fs|de}"
    exit 1
fi

# Validate the argument
case "$1" in
    g|be|fs|de)
        TYPE=$1
        ;;
    *)
        echo "Error: Invalid argument '$1'. Must be one of: g, be, fs, de"
        echo "Usage: $0 {g|be|fs|de}"
        exit 1
        ;;
esac

INPUT_FILE="logan_resume_${TYPE}.xtx"
OUTPUT_FILE="logan_resume_${TYPE}.pdf"
TMP_DIR="latex_output"

# Check if the input file exists
if [ ! -f "$INPUT_FILE" ]; then
    echo "Error: Input file '$INPUT_FILE' not found."
    exit 1
fi

echo "Building ${OUTPUT_FILE} from ${INPUT_FILE}..."

mkdir -p "$TMP_DIR"
xelatex -output-directory="$TMP_DIR" "$INPUT_FILE"

# Check if xelatex was successful and created the PDF
# Note: xelatex outputs the PDF with the same base name as the input .xtx file
if [ -f "${TMP_DIR}/logan_resume_${TYPE}.pdf" ]; then
    mv "${TMP_DIR}/logan_resume_${TYPE}.pdf" "${OUTPUT_FILE}"
    echo "Successfully created ${OUTPUT_FILE}"
else
    echo "Error: Failed to create ${OUTPUT_FILE}. Check LaTeX logs in ${TMP_DIR}."
    # Optionally keep the tmp dir for debugging: rm -rf "$TMP_DIR"
    exit 1
fi

echo "Build complete."
